-# This file is app/views/courses/edit.html.haml
!!! 5

- content_for :title, "Edit Class"

.row
  .span5.module#class-edit
    .module-heading
      .module-heading-title Edit Class
  
    .module-content
      = form_tag course_path(@course), :method => "put", :class =>"form-horizontal" do
        .control-group 
          = label :course, :name, 'Name', :class => "control-label"
          .controls
            = text_field :course, :name

        .control-group
          = label :temp, :ptainstructor_id, 'Instructor', :class => "control-label"
          .controls
            = select_tag "course[ptainstructor_id]", options_from_collection_for_select(@ptainstructors, :id, :full_name_first_last, @course.ptainstructor_id), 
                :prompt => 'Select Instructor', :class => "course_select"

        .control-group
          = label :course, :description, 'Description', :class => "control-label"
          .controls
            = text_area :course, :description, :rows => 5

        .control-group
          .control-label Day
          .controls
            = label :course, 'Mon', :class => "checkbox inline" do
              = check_box :course, :monday, :id => "course_monday"
              Mon
            = label :course, 'Tue', :class => "checkbox inline" do
              = check_box :course, :tuesday, :id => "course_tuesday"
              Tue
            = label :course, 'Wed', :class => "checkbox inline" do
              = check_box :course, :wednesday, :id => "course_wednesday"
              Wed
            = label :course, 'Thu', :class => "checkbox inline" do
              = check_box :course, :thursday, :id => "course_thursday"
              Thu
            = label :course, 'Fri', :class => "checkbox inline" do
              = check_box :course, :friday, :id => "course_friday"
              Fri

        .control-group
          = label :course, :start_time, 'Start time', :class => "control-label"
          .controls
            = text_field :course, :start_time, :placeholder => "e.g. 3:00PM"
        
        .control-group
          = label :course, :end_time, 'End time', :class => "control-label"
          .controls
            = text_field :course, :end_time, :placeholder => "e.g.  5:00PM"

        .control-group
          = label :temp, :location, 'Room', :class => "control-label"
          .controls
            = select_tag "course[teacher_id]", options_from_collection_for_select(@teachers, :id, :classroom, @course.teacher_id), 
                :prompt => 'Select Room', :class => "course_select"

        .control-group
          = label :course, :grade_range, 'Eligible grades', :class => "control-label"
          .controls
            = text_field :course, :grade_range

        .control-group
          = label :course, :class_min, 'Min. class size', :class => "control-label"
          .controls
            = text_field :course, :class_min, :class => "span1"

        .control-group
          = label :course, :class_max, 'Max. class size', :class => "control-label"
          .controls
            = text_field :course, :class_max, :class => "span1"

          -# .control-group
          -#   = label :course, :number_of_classes, 'Number of meetings', :class => "control-label"
          -#   .controls
          -#     = text_field :course, :number_of_classes, :class => "span1", :id => "course_number_of_classes"
          -#     = link_to "Calculate", "#", :id => "calc_meeting_number"

        .control-group
          = label :course, :fee_per_meeting, 'Per meeting fee', :class => "control-label"
          .controls
            .input-prepend
              %span.add-on $
              = text_field :course, :fee_per_meeting, :value => sprintf("%0.2f", @course.fee_per_meeting), :class => "span1"

        .control-group
          = label :course, :fee_for_additional_materials, 'Material fee', :class => "control-label"
          .controls
            .input-prepend
              %span.add-on $
              = text_field :course, :fee_for_additional_materials, :value => sprintf("%0.2f", @course.fee_for_additional_materials), :class => "span1"

        .control-group
          = label :course, :total_fee, 'Total fee', :class => "control-label"
          .controls
            .input-prepend
              %span.add-on $
              = text_field :course, :total_fee, :value => sprintf("%0.2f", @course.total_fee), :class => "span1"
            = link_to "Calculate", "#", :id => "calc_total_fee"

        .control-group
          .controls
            = submit_tag 'Update', :class => "btn btn-warning"
            = link_to 'Cancel', course_path, :class => "btn btn-info"

- content_for :js do
  :javascript
    $("#calc_meeting_number").click(function(event) {
        event.preventDefault();
        var jsonObj = {};
        jsonObj[7] = $("#course_sunday").attr('checked');
        jsonObj[1] = $("#course_monday").attr('checked');
        jsonObj[2] = $("#course_tuesday").attr('checked');
        jsonObj[3] = $("#course_wednesday").attr('checked');
        jsonObj[4] = $("#course_thursday").attr('checked');
        jsonObj[5] = $("#course_friday").attr('checked');
        jsonObj[6] = $("#course_saturday").attr('checked');
        $.ajax({
          type: "GET",
          url: "#{calculate_meetings_for_course_path}",
          dataType: "json",
          data: jsonObj
        }).done(function(data) {
          $("#course_number_of_classes").val(data);
        });
      });
      $("#calc_total_fee").click(function(event) {
        event.preventDefault();
        var course_fee = $("#course_fee_per_meeting").val();
        var course_number = $("#course_number_of_classes").val();
        var additional_fees = $("#course_fee_for_additional_materials").val();
        if(!isNaN(course_fee) && !isNaN(course_number) && !isNaN(additional_fees)){
          var total = Number(course_fee) * Number(course_number) + Number(additional_fees);
          $("#course_total_fee").val(total);
        }else{
          alert('"Price Per Student Per Meeting", "Number of Meetings", or "Fee for Additional Materials" does not contain a valid number');
        }
      });

